## Goal
>
ìƒì„±í•œ pv, pvcë¥¼ kubectl delete ëª…ë ¹ì–´ë¡œ ì‚­ì œê°€ ì•ˆë˜ëŠ” ì›ì¸ì„ íŒŒì•…í•˜ê³  í•´ê²°í•œë‹¤.

```
k delete -f prometheus-server-volume.yaml

âš¡ root@master î‚° ~/prometheus î‚° k get pv
NAME                CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS        CLAIM                       STORAGECLASS   REASON   AGE
prometheus-server   10Gi       RWX            Retain           Terminating   default/prometheus-server                           131m
```
>
delete í•´ë„ STATUS == Terminating ìƒíƒœì—ì„œ ì§€ì›Œì§€ì§€ ì•ŠëŠ”ë‹¤.
kubectl delete pv (pv name) --grace-period=0 --force ëª…ë ¹ì–´ë¡œë„ ì‚­ì œê°€ ë¶ˆê°€ëŠ¥.

[ì¿ ë²„ë„¤í‹°ìŠ¤ ê³µì‹ ë¬¸ì„œ](https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/#finalizers) ì— ë”°ë¥´ë©´ ì‚­ì œê°€ ë¶ˆê°€ëŠ¥ í•œ ì´ìœ ëŠ” Finalizer ë•Œë¬¸ì´ë‹¤. 

## âœŒì‚­ì œí•˜ëŠ” ë²•

```
kubectl edit pv
kubectl edit pvc
```
![](https://velog.velcdn.com/images/hyunshoon/post/d5bef399-1ca2-4903-8f40-2d113f116ef7/image.png)

ìœ„ finalizerë¥¼ ì‚­ì œí•´ì¤€ë‹¤. ì´ë¯¸ Terminating ìƒíƒœì´ë¯€ë¡œ ìˆ˜ì •ë§Œ í•´ì£¼ë©´ pv, pvcëŠ” ì‚­ì œëœë‹¤.

## ğŸ¤·â€â™‚ï¸Finalizer?

Finalizerë¥¼ ì§€ì›Œì£¼ë©´ ì‚­ì œëœë‹¤ëŠ” ê²ƒì„ ì•Œì•˜ë‹¤. ì´ì œ ê·¸ ì›ë¦¬ë¥¼ ì•Œì•„ë³´ì.

### Summary

>
íŒŒì´ë„ë¼ì´ì €ëŠ” ë¦¬ì†ŒìŠ¤ê°€ ì‚­ì œë˜ê¸° ì „ ì¶©ì¡±ë˜ì•¼í•  ì¡°ê±´ì´ë‹¤. 
>
Finalized ëœ ë¦¬ì†ŒìŠ¤ì˜ ì‚­ì œ ëª…ë ¹ì´ ë–¨ì–´ì§€ë©´, ì¡°ê±´ì´ ì¶©ì¡±ë  ë•Œ ê¹Œì§€ ë¦¬ì†ŒìŠ¤ëŠ” ë³€ê²½ì‚¬í•­ì— ëŒ€í•´ ì ê¸´ë‹¤.
>
íŒŒì´ë„ë¼ì´ì €ëŠ” ì»¨íŠ¸ë¡¤í”Œë ˆì¸ì´ë‚˜ Operatorì™€ ê°™ì€ ì»¤ìŠ¤í…€ ì»¨íŠ¸ë¡¤ëŸ¬ì— ì‹œê·¸ë„ì„ ë³´ë‚´ëŠ”ë° ì‚¬ìš©ëœë‹¤. ì‹œê·¸ë„ì„ ë³´ë‚´ ì™„ì „íˆ ë¦¬ì†ŒìŠ¤ë¥¼ ì œê±°í•˜ê¸°ì „ì— í•´ë‹¹ ë¦¬ì†ŒìŠ¤ë¥¼ ì •ë¦¬í•˜ëŠ”ë° ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ.

### ê³µì‹ ë¬¸ì„œ ì„¤ëª…

>
íŒŒì´ë„ë¼ì´ì €ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ **ì˜¤ë¸Œì íŠ¸ë¥¼ ì™„ì „íˆ ì‚­ì œí•˜ê¸° ì´ì „**, ì‚­ì œ í‘œì‹œë¥¼ ìœ„í•´ **íŠ¹ì • ì¡°ê±´ì´ ì¶©ì¡±ë  ë•Œê¹Œì§€ ëŒ€ê¸°**í•˜ë„ë¡ ì•Œë ¤ì£¼ê¸° ìœ„í•œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ì†í•œ í‚¤(namespaced key)ì´ë‹¤. **íŒŒì´ë„ë¼ì´ì €ëŠ” ì‚­ì œ ì™„ë£Œëœ ì˜¤ë¸Œì íŠ¸ê°€ ì†Œìœ í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ì •ë¦¬í•˜ê¸° ìœ„í•´ ì»¨íŠ¸ë¡¤ëŸ¬ì—ê²Œ ì•Œë¦°ë‹¤.**
>
íŒŒì´ë„ë¼ì´ì €ë¥¼ ê°€ì§„ íŠ¹ì •í•œ ì˜¤ë¸Œì íŠ¸ë¥¼ ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ ì‚­ì œí•˜ë„ë¡ ì§€ì‹œí•  ë•Œ, ì¿ ë²„ë„¤í‹°ìŠ¤ APIëŠ” .metadata.delationTimestampì„ ë§ë¶™ì—¬ ì‚­ì œí•˜ë„ë¡ ì˜¤ë¸Œì íŠ¸ì— í‘œì‹œí•˜ë©°, 202 ìƒíƒœì½”ë“œ(HTTP "Accepted")ì„ ë¦¬í„´í•œë‹¤. **ëŒ€ìƒ ì˜¤ë¸Œì íŠ¸ê°€ Terminating ìƒíƒœë¥¼ ìœ ì§€í•˜ëŠ” ë™ì•ˆ** ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ ë˜ëŠ” ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ëŠ” í•˜ë‚˜ì˜ íŒŒì´ë„ë¼ì´ì €ì—ì„œ ì •ì˜í•œ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤. ì •ì˜ëœ ì‘ì—…ì´ ì™„ë£Œ í›„ì—, ê·¸ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ëŒ€ìƒ ì˜¤ë¸Œì íŠ¸ë¡œë¶€í„° ì—°ê´€ëœ íŒŒì´ë„ë¼ì´ì €ì„ ì‚­ì œí•œë‹¤. metadata.finalizers í•„ë“œê°€ ë¹„ì–´ ìˆì„ ë•Œ, ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì‚­ì œê°€ ì™„ë£Œëœ ê²ƒìœ¼ë¡œ ê°„ì£¼í•˜ê³  ì˜¤ë¸Œì íŠ¸ë¥¼ ì‚­ì œí•œë‹¤.
>
íŒŒì´ë„ë¼ì´ì €ê°€ ë¦¬ì†ŒìŠ¤ë“¤ì˜ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ì„ ì œì–´í•˜ë„ë¡ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, í•˜ë‚˜ì˜ íŒŒì´ë„ë¼ì´ì €ë¥¼ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ëŒ€ìƒ ë¦¬ì†Œì†Œë¥¼ ì‚­ì œí•˜ê¸° ì „ì— ì—°ê´€ëœ ë¦¬ì†ŒìŠ¤ë“¤ ë˜ëŠ” ì¸í”„ë¼ë¥¼ ì •ë¦¬í•˜ë„ë¡ ì •ì˜í•  ìˆ˜ ìˆë‹¤.
>
íŒŒì´ë„ë¼ì´ì €(Finalizer)ë¥¼ ì‚¬ìš©í•˜ë©´ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚­ì œí•˜ê¸° ì „ íŠ¹ì • ì •ë¦¬ ì‘ì—…ì„ ìˆ˜í–‰í•˜ë„ë¡ ì»¨íŠ¸ë¡¤ëŸ¬(Controller)ì— ê²½ê³ í•˜ì—¬ ë¦¬ì†ŒìŠ¤ì˜ ê°€ë¹„ì§€(Garbage) ìˆ˜ì§‘ì„ ì œì–´í•  ìˆ˜ ìˆë‹¤.
>
íŒŒì´ë„ë¼ì´ì €ëŠ” ë³´í†µ ì‹¤í–‰í•  ì½”ë“œë¥¼ ì§€ì •í•˜ì§€ ì•ŠëŠ”ë‹¤. ëŒ€ì‹  íŒŒì´ë„ë¼ì´ì €ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì–´ë…¸í…Œì´ì…˜ê³¼ ë¹„ìŠ·í•˜ê²Œ íŠ¹ì • ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ í‚¤ë“¤ì˜ ëª©ë¡ì´ë‹¤. ì¼ë¶€ íŒŒì´ë„ë¼ì´ì €ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ ìë™ìœ¼ë¡œ ì§€ì •í•˜ì§€ë§Œ, ì‚¬ìš©ìê°€ ì§ì ‘ ì§€ì •í•  ìˆ˜ë„ ìˆë‹¤.


#### ê²°ë¡ ì ìœ¼ë¡œ pv, pvc ë§ê³ ë„ deleteë¡œ ì‚­ì œí•œ pod ê°€ Terminating ìƒíƒœì— ê°‡í˜€ ìˆë‹¤ë©´ finalizerë¥¼ ì‚­ì œí•´ë³´ì.

Reference
- https://kubernetes.io/ko/docs/concepts/overview/working-with-objects/finalizers/
- https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/#finalizers
- https://kubebyexample.com/learning-paths/operator-framework/kubernetes-api-fundamentals/finalizers