> 본 프로젝트에서 어떤 LB를 사용해야 할지 결정하기 위해, 각 LB가 각각 어떻게 다르고, 어떤 기능을 하며, 사용 비용이 어느정도로 예상 되는 지 정리해보기 위해 작성된다.
  
```
1. LB란
2. AWS ELB란
3. AWS ELB - NLB란
4. AWS ELB - ALB란
```

---
### Load Balancer

> LB란 트래픽이 과도하게 몰려 서비스가 중단되는 현상을 막기 위해, 부하(트래픽)를 여러 대상에 자동으로 분산시키는 기술이다.

> LB는 부하 분산 뿐만아니라 scale out에 대한 하나의 엔드포인트를 제공하기도 하는데, 오토스케일링 그룹을 통해 여러개의 인스턴스를 생성(scale out)하고 관리함으로 고가용성을 확보하고, 안정적인 서비스를 제공할 수 있다.

> 부하 분산을 위한 LB는 OSI 7 계층 중 어느 계층에서 동작하는지에 따라서 NLB(Network LoadBalancer)와 ALB(Application LoadBalancer)로 나뉜다.

> LB에서 트래픽을 하나의 경로로 받아서 다수의 인스턴스에 분산하게 되어, 유저 입장에서는 각각의 인스턴스에 일일히 접근해서 관리하는게 아닌 하나의 주소로 접속해서 관리 할수 있게 된다. 만약 인스턴스가 오류가 나거나 종료되어 트래픽을 수신하지 못하게 되면 LB가 알아서(health check / monitoring) 트래픽을 전송하지 않고, 새로운 인스턴스가 등록되면 자동으로 분산을 시킨다. 

![image](https://user-images.githubusercontent.com/88362207/203567579-657cc642-f720-44fe-a9f8-6727af63ae27.png)

---
### ELB

> Elastic Load Balancing(ELB)은 AWS에서 제공하는 4가지 유형의 로드 밸런서를 지원한다. 애플리케이션 요구 사항에 따라 적절한 로드 밸런서를 선택할 수 있다.

> ELB의 종류는 다음과 같다.
```
Application Load Balancer (ALB)
Network Load Balancer (NLB)
Gateway Load Balancer (GWLB)
Classic Load Balancer (CLB)
```
> 이 셋 모두 부하분산을 하는 로드밸런서라는 점은 동일하지만 역할이 각각 다르다.

![image](https://user-images.githubusercontent.com/88362207/203572234-2a43ff3b-712c-42d8-9201-b0f08ead887d.png)

> ELB는 VPC에 탑재되며, 사용자의 요청을 받고 VPC 내 리소스(EC2)에 부하 분산한다.

> ELB는 외부의 요청을 받아들이는 리스너(Listener)와 요청을 분산할 리소스의 집합인 대상 그룹(Target Group)으로 구성되며, ELB는 다수의 리스너와 대상 그룹을 거느릴 수 있다.



---
### NLB

---

### ALB
![image](https://user-images.githubusercontent.com/88362207/203574364-8390872a-5547-42be-9ecd-5f7ad5e9c838.png)

> ALB는 AWS에서 제공하는 4가지 로드밸런서 중 하나로, OSI 모델 7계층인 애플리케이션 계층에서 작동한다.사용자와 직접 접하는 계층으로, Application Layer에는 HTTP/HTTPS뿐만 아니라 FTP, DNS, DHCP, WebSocket 등 다양한 프로토콜이 존재한다.

> ALB는 단순 부하분산뿐 아니라 HTTP/HTTPS의 헤더 정보를 이용해 부하분산을 할 수 있다.(지능적인 라우팅(부하 분산) 기능) 즉, HTTP 헤더의 값들을 보고 어느 대상 그룹으로 보낼지를 판단할 수 있다.
예를 들면, 로드 밸런서 하나만 설정하면 트래픽을 모니터링하여 각 대상그룹에 라우팅을 하게 해준다.
/user 경로로 오면 람다 대상그룹에 보내주고, /shop 으로 오면 회원관리 대상그룹에 보내주는 식이다.
따라서 로드밸런서의 갯수를 줄일수 있고 이는 곧 비용 절감으로 이어진다.

> ALB는 path(경로) 뿐만 아니라 port(포트)에 따라 다른 대상그룹으로 맵핑할 수도 있다. 각각의 포트에 따라 다르게 구성할 수 있으며, 동일한 포트라도 path(경로)등에 따라 다르게 분기할 수도 있다. 특히 포트 단위로 연결해줄 수 있는 것은 도커 컨테이너 환경에서 아주 유용하게 작동할 수 있고 하나의 대상그룹에 더 많은 컨테이너를 넣어 비용을 최적화할 수 있다.

> ALB는 대상을 EC2 인스턴스 뿐만 아니라 람다, IP로도 연결이 가능하며 특정한 요청에 대해서는 서버없이 직접 응답메세지를 작성할 수 있기때문에 마이크로아키텍쳐를 구성하기에 좋다. 그리고 SSL 인증서를 탑재할 수 있어 대상 그룹의 EC2를 대신하여 SSL 암호화/복호화를 대신 진행할 수 있다.



---





LB는 요청을 받으면 우선 순위에 따라 리스너 규칙을 평가하여 적용할 규칙을 결정한 다음, 규칙 작업의 대상 그룹에서 대상을 선택한다.
  
애플리케이션 트래픽의 콘텐츠를 기반으로 다른 대상 그룹에 요청을 라우팅하도록 리스너 규칙을 구성할 수 있다. 대상이 여러개의 대상 그룹에 등록이 된 경우에도 각 대상 그룹에 대해 독립적으로 라우팅이 수행된다.
  
대상 그룹 레벨에서 사용되는 라우팅 알고리즘을 구성할 수 있다. 기본 라우팅 알고리즘은 라운드 로빈이다. 그 대신 최소 미해결 요청 라우팅 알고리즘을 지정할 수 있다.

> 라운드 로빈
> 
> 라운드 로빈(RR; Round Robin) 또는 라운드 로빈 스케줄링(Round Robin Scheduling)은 시분할 시스템을 위해 설계된 선점형 스케줄링의 하나로서, 프로세스들 사이에 우선순위를 두지 않고, 순서대로 시간 단위로 CPU를 할당하는 방식의 CPU 스케줄링 알고리즘이다.
  
  
