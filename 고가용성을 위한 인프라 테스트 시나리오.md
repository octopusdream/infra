### 고가용성이란?
> 전체 시스템에 대한 개념이다. 사람이 개입하지 않아도 시스템이 항상 작동하며 액세스 가능하며, 가동 중지를 최소화하도록 보장하는 것이다.
> 시스템을 1분이라도 사용할 수 없으면 비즈니스에 중대한 손상을 입힌다.
>
> AWS 고가용성 도구 - 특정 서비스가 고가용성을 제공할 때 도움이 되는 방법에 대해 살펴보자
> 
> ELB - 지연 시간이 길거나 서버가 과다 사용되는 경우 이를 알리는 트리거로 동작한다.
> EIP - 애플리케이션의 내결함성을 향상시킬 때 유용하다. 인스턴스가 실패하더라도 클라이언트가 애플리케이션에 액세스할 수 있으므로 고가용성이 보장된다.
> Route 53 - 단순 라우팅, 지연 시간에 따른 라우팅, 상태확인, DNS 장애 조치, 지리 위치 라우팅 지원하기 위해 개발 되었으며, 이 모든 특성을 통해 고객 대면 애플리케이션의 가용성이 증가한다.
> Auto Scaling & CloudWatch- 설정된 임계값을 통과한 지표가 있는 경우 Auto Scaling과 함께 CloudWatch가 자동으로 확장되어 아키텍처의 고가용성을 보장할 수 있다.
> 여러 AZ

### 내결함성이란?
> 시스템의 일부 구성요소에 장애가 있어도 시스템이 계속 작동할 수 있는 기능 (애플리케이션 관점)
> 
> SQS - 내결함성과 애플리케이션의 백본으로 사용, 안정적인 분산 메시징 시스템, 대기열 항시 사용 가능
> S3 - 내구성과 결함성이 뛰어난 데이터 스토리지이며, 리전 내 여러 시설에서 각 디바이스의 모든 데이터를 중복 저장
> RDS - 자동 백업, 스냅샷, 여러 가용 영역 지점

### 탄력성이란?
> 용량 요구사항에 대해 신경쓰지 않고 자동화된 확장 및 축소 
> 
> 트래픽 급증 시 웹 서버 수 증가
> 트래픽이 줄어들 때 데이터베이스 쓰기 용량 감소 (IOPS : Input/Output Opereations Per Second)
> 아키텍쳐 전반에 걸친 일상적인 수요 변동 처리
> 시간 기반 탄력성 : 리소스가 사용되지 않을 때 리소스 끄기
> 볼륨 기반 탄력성 : 수용 강도에 맞게 규모 조정


AWS 는 사용자가 가용성이 높은 내결함성 시스템과 아키텍처를 구축할 때 제공된다. AWS는 사용자가 사람의 개입과 선결제 투자를 최소화하여 이러한 시스템을 구축할 수 있으며 이 모든 것을 요구에 따라 사용자 지정할 수있다는 점에서 고유하다.


가용성이란 컴퓨터 시스템이 정상적인 사용을 위해 액세스할 수 있는 총 시간의 비율이다.

즉, 가용성은 시스템이 온라인 상태이고 액세스 할 수 있는 정도를 나타낸다. 최적의 가용성이 100%라고 가정할 수 있겟지만, 100%는 불가능하다.

이때, 고가용성이 필요하다. HA 시스템은 온라인 가용성이 99.9~99.999%인 시스템이다.

시스템 장애 발생 시 지속적인 작동을 가능하게 하는 다양한 시스템 기능 구축이 포함됩니다. 내결함성(시스템의 일부 구성 요소가 작동하지 않더라도 계속 작동할 수 있는 기능) 기능의 예로는 이중화 및 복제가 있습니다. 























1. aws availability zone 죽이기


문제는 안정성이다. AWS가 멈추자 한국의 주요 인터넷 서비스가 멈췄다. 7.7 디도스와 같은 대규모 해킹공격보다 더 큰 피해가 발생했다.

이 때문에 재해복구(DR)에 대한 필요성이 크게 대다. DR은 화재, 홍수, 지진 등 천재지변 등 예상치 못한 사태에 데이터센터에 장애가 발생했을 때를 대비해 원거리에 복제 시스템을 두는 것을 말한다.

국내 인터넷 기업은 DR에 소극적인 편이다. DR보다는 고가용성(HA)에 주로 투자한다. HA는 특정 시스템에 장애가 났을 때 다른 시스템이 이를 받아 서비스를 계속 하는 기술이다. HA는 같은 지역 내에서 시스템을 이중화, 삼중화 한다. 이번 AWS 장애처럼 지역 전체 시스템에 문제가 발생했을 때는 HA가 할 수 있는 일이 없다.

많은 전문가들은 이번 AWS 장애 이후 ‘멀티 리전 DR(복수의 리전에 DR 시스템을 두는 것)’의 중요성을 이야기 한다. 한 IT전문가는 “이번 AWS 장애는 한국 리전에서만 벌어졌다. 일본 등 다른 리전을 이용하는 기업은 장애에서 예외였다”면서 “다른 리전을 복수로 이용했다면 이와 같은 큰 피해는 입지 않았을 것”이라고 말했다.

이와 관련 이번에 장애를 겪은 A 업체 관계자는 “멀티 리전 DR이 필요하다는 것은 알지만, 비용이 두 배가 들기 때문에 당장 하기 어렵다”고 말했다.

B 업체 관계자는 DR무용론을 꺼냈다. 이 관계자는 “이번에 한국 리전 전체가 다운됐는데 다른 리전에 DR이 돼 있더라고 하더라도 다른 리전에서 서비스 가동되기까지 시간이 많이 걸린다”면서 “다른 리전에서 서비스를 생성하는 중간에 한국 리전이 복구됐을 가능성이 높다”고 전했다.

C업체는 멀티 리전은 아니지만 AZ( Availability Zone, 가용 영역) 수준의 DR을 하고 있었다. AZ는 한 리전에 속해 있지만 물리적으로 분리된 데이터센터다. 하나의 리전은 복수의 AZ로 구성된다. AWS 서울리전도 두 개의 AZ로 구성돼 있으며 하나는 수도권에, 하나는 비수도권에 존재하는 것으로 알려져있다.




리전과 AZ 개념(출처 : AWS 홈페이지)

C 업체 관계자는 “이런 사태를 대비하기 위해 (서울 리전) 두 개의 AZ에 서비스를 병행해 운영하고 있었다”면서 “그럼에도 불구하고 이번 장애는 서울 리전 전체에 여파를 미쳤기 때문에 어쩔 수 없었다”고 설명했다.

이 관계자는 “다른 리전을 안 쓴 이유는 한국 리전보다 응답시간이 조금 더 오래 걸리는 부분이 있어서, 서비스를 운영하는 시스템 사이에 동기화할 정보들이 많이 있는 경우 시스템 부하 문제가 있을 수 있기 때문”며넛 “이번을 계기로, 일부 비용을 감수하고라도 향후 도쿄 리전을 병행해 이용하는 것을 내부 검토 중”이라고 말했다.





▶ 데이터센터의 클러스터

 

 - 한 리전에는 여러 가용성 영역이 있다 (한 리전당 최소 2AZ)

 - 전용선으로 연결 되어 있기 때문에 마친 한 건물인 것과 같이 빠르게 데이터를 주고 받을 수 있다. (데이터 센터의 클러스터)

 - 그렇기 때문에 빠르게 데이터를 백어 하고 데이터를 이전할 수 있는 구조이다.

 

 

▶ 다른 가용영역(AZ)의 장애로부터 격리됨
 - 각각의 다른 가용 영역의 장애로부터 격리될 수 있다는 점이 중요하다.
 - 자연재해 또는 단층선에 문제가 발생할 수 있는 곳은 AWS에서 가용영역을 분리한다.

   (리전의 AZ들은 지연시간이 짧은 링크를 통해 연결되어 있다.)

 - 좀더 쉽게 예를 들어 설명하자면 

   하나의 지역에 혹시 특정 서비스들 이용할 수 있는 하나의 건물이 있다고 생각 해보자.
   혹시 이 건물이 자연재해로 인해 (지진 등) 건물이 부서진다고 하면 아무 서비스를 이용할 수 없을 것이다.
   똑같은 서비스를 타지역의 다른 건물에서 서비스 하고있다면 일단 해당 건물을 통해 서비스는 가능 한 것이다.
 
   즉, 현재 서울의 AZ는 2개이고 한개의 AZ가 장애가 나더라도 다른 AZ를 통해 서비스가 가능한 구조이다.
   이런 위험 분산 측면에서 AZ가 최소한 2개이상으로 구성되어 있는 것 같다.


이 당시 대안으로 얘기가 나왔던 것이 멀티클라우드 이다.

 - 일본 등 다른 지역의 AWS 리전으로 멀티 클라우드를 적용한 기업들은 이번 장애를 피할 수 있었기 때문이다.

 

AWS와 기업들은 SLA(서비스레벨어그리먼트) 99.95% 서비스 수준 계약을 체결 한다.

(SLA 99.95%란 한 달에 4시간 이상 서비스 장애가 발생해야만 보상을 제공한다는 내용)

어찌보면 고객에게 불리할 수 있는 조항이다.

또 앞으로도 장애가 발생하지 않는다는 보장도 없다.

 

정말 단 1분 1초도 서비스가 중지되는 사태를 멀티클라우드를 통해 피해 갈 수 있을 것으로 생각 되지만, 비용문제도 있을 수 있으니 신중히 접근하도록 해야 할 것 같다.
AWS 구축시 한번쯤 고려해 볼 만한 사항이다.


그리고 AWS 수업을 듣고 난 직후이기에 한가지 정리 해두려 한다.

리전별로 가격이 다른데 어디가 가장 싸고 비쌀까?



3. auto scaling test (node, pod)
4. master node HA
5. 
